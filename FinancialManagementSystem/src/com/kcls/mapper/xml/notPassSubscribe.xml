<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="com.kcls.mapper.NotPassSubscribeMapper">
	 <select id="getNotPassSubscribe" parameterType="com.kcls.bean.Page" resultType="com.kcls.bean.SubScribeBean">
	 		select s.*,(select u.user_name from kcls_2017_user u where u.user_id = s.user_id) as user_name,
			(select c.course_name from kcls_2017_spendingCourse c where c.course_id = s.course_id) 
				as course_name from kcls_2017_purchase s where s.cashier_state = 1 and 
					s.purchase_title like concat('%',#{searchText},'%') and s.course_id 
						like concat('%',#{searchText1},'%') and s.user_id = #{searchText2} limit #{pageNumber},#{pageSize}
	 </select>
	 <select id="getNotPassSubscribeCount" parameterType="com.kcls.bean.Page" resultType="java.lang.Integer">
	 		select count(*) from kcls_2017_purchase s where s.cashier_state = 1 and 
					s.purchase_title like concat('%',#{searchText},'%') and s.course_id 
						like concat('%',#{searchText1},'%') and s.user_id = #{searchText2}
	 </select>
	 <delete id="notPassSubscribeDelete" parameterType="com.kcls.bean.SubScribeBean">
	 		delete from kcls_2017_purchase where purchase_id = #{purchase_id}
	 </delete>
	 <update id="notPassSubscribeAgainSubmit" parameterType="com.kcls.bean.SubScribeBean">
	 		update kcls_2017_purchase set cashier_state = 2 where purchase_id = #{purchase_id}
	 </update>
	 <select id="selectANotPassSubscribe" parameterType="com.kcls.bean.SubScribeBean" resultType="com.kcls.bean.SubScribeBean">
	 		select s.*,(select u.user_name from kcls_2017_user u where u.user_id = s.user_id) as user_name,
			(select c.course_name from kcls_2017_spendingCourse c where c.course_id = s.course_id) 
				as course_name from kcls_2017_purchase s where s.purchase_id = #{purchase_id}
	 </select>
	 <update id="notPassSubscribeUpdate" parameterType="com.kcls.bean.SubScribeBean">
	 		update kcls_2017_purchase set purchase_title = #{purchase_title}, course_id = #{course_id}, purchase_money = #{purchase_money}, purchase_matter = #{purchase_matter} where purchase_id = #{purchase_id}
	 </update>
</mapper>