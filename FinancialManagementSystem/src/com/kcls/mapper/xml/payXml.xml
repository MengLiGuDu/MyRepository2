<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kcls.mapper.PayMapper">
	<select id="getNodes" resultType="com.kcls.bean.NodeBean">
		select course_id as node_id,fatherCourse_id as parent_id,course_name as text from kcls_2017_spendingCourse
	</select>
	<select id="getCourse" resultType="com.kcls.bean.PaySubjectBean">
		select course_id,course_name from kcls_2017_spendingCourse where fatherCourse_id is not null
	</select>
	<select id="getAccount" resultType="com.kcls.bean.AccountBean">
		select account from kcls_2017_account 
	</select>
	<select id="selectPay" parameterType="com.kcls.bean.Page" resultType="com.kcls.bean.SpendingBean">
		select * from kcls_2017_spending where spending_name like concat('%',#{searchText},'%') and payment_name like concat('%',#{searchText1},'%') and course_id like concat('%',#{searchText2},'%') and spending_state = 0 limit #{pageNumber},#{pageSize}
	</select>
	<select id="selectPayCount" parameterType="com.kcls.bean.Page" resultType="java.lang.Integer">
		select count(*) from kcls_2017_spending where spending_name like concat('%',#{searchText},'%') and payment_name like concat('%',#{searchText1},'%') and course_id like concat('%',#{searchText2},'%') and spending_state = 0
	</select>	
	<select id="selectAAccount" parameterType="com.kcls.bean.SpendingBean" resultType="java.lang.String">
		select account_name from kcls_2017_account where account = #{payment_accountNum}
	</select>
	<insert id="payAdd" parameterType="com.kcls.bean.SpendingBean">
		insert into kcls_2017_spending(spending_id,course_id,spending_name,spending_remark,payment_name,gathering_name,payment_accountNum,gathering_number,create_date,spending_state) values(#{spending_id},#{course_id},#{spending_name},#{spending_remark},#{payment_name},#{gathering_name},#{payment_accountNum},#{gathering_number},sysDate(),0)
	</insert>
	<update id="paySubmit" parameterType="com.kcls.bean.SpendingBean">
		update kcls_2017_spending set spending_state = 1 where spending_id = #{spending_id}
	</update>
	<delete id="payDelete" parameterType="com.kcls.bean.SpendingBean">
		delete from kcls_2017_spending where spending_id = #{spending_id}
	</delete>
	<update id="payUpdate" parameterType="com.kcls.bean.SpendingBean">
		update kcls_2017_spending set course_id = #{course_id}, spending_name = #{spending_name}, spending_remark = #{spending_remark}, payment_name = #{payment_name}, gathering_name = #{gathering_name}, payment_accountNum = #{payment_accountNum}, gathering_number = #{gathering_number} where spending_id = #{spending_id}
	</update>
	<select id="getSpending" parameterType="com.kcls.bean.SpendingBean" resultType="com.kcls.bean.SpendingBean">
		select * from kcls_2017_spending where spending_id = #{spending_id}
	</select>
</mapper> 